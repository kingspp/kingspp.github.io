<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Singleton's Skeleton!!</title>
  <meta name="description" content="Singleton, the name says it all - Comprises of a single entity. Often in python this pattern is overlooked.But lately to my surprise, it is the key to succes...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4000/design/2017/11/05/singleton's-skeleton.html">
  <link rel="alternate" type="application/rss+xml" title="Kalpane" href="http://localhost:4000/feed.xml" />

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Quicksand' rel='stylesheet' type='text/css'>
</head>


  <body>

    <div class="site-header">

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <i class="fa fa-navicon fa-lg"></i>
      </a>

      <div class="trigger">
        
          <a class="page-link" target="_top"
             href="http://localhost:4000/">Home</a>
        
          <a class="page-link" target="_top"
             href="http://localhost:4000/about">About</a>
        
          <a class="page-link" target="_top"
             href="http://localhost:4000/archive">Archive</a>
        
          <a class="page-link" target="_blank"
             href="http://github.com/kingspp">GitHub</a>
        
      </div>
    </nav>

</div>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
     <h1 class="post-title">Singleton's Skeleton!!</h1>
     <p class="post-meta">
         <i class="fa fa-calendar-o"></i> Nov 5, 2017
          • <i class="fa fa-user"></i> kingspp
         </p>
         <p>Singleton - Python's obvious choice for global configuration</p>
  </header>

    <div class="post-paging">
  
    <div class="left">
      <a href="/tricks/2017/11/04/toying-around-with-casperJS.html">
        <i class="fa fa-angle-left fa-2x"></i>
      </a>
    </div>
  
  
</div>

  


  <article class="post-content">
    <p><strong>Singleton</strong>, the name says it all - Comprises of a single entity. Often in python this pattern is overlooked.
But lately to my surprise, it is the key to success, for global configuration. Python is known to be a simple, easy
going noob’s programming language. At the heart of its implementation, the easiness and the least learning curve raised 
its status as world’s best programming language for a Data Scientist. But in reality python is such a pa^^ to develop
complex structures because of its - no restriction’s rule. I do agree that restriction free language works best for prototyping,
but unfortunately to build a library it is cumbersome. Since its <em>python</em> - anything can be designed and implemented, <strong>the sky’s 
the limit</strong>.</p>

<p>Lets say, you want to build a set of tools required for a project. As a developer evolves from a noob to 
an architect, his set of tools, evolve. This evolution brings in the concept of abstraction. So lets say we have 
a set of tools and we call it a library.</p>

<p>We will design the library - <strong>Child monitoring suite</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c"># config.json</span>

<span class="s">'''
Lets assume that we have build a library and a flexible one. The library comes with set 
of configurable parameters. Lets say the configuration is in json format
'''</span>  

<span class="n">library_config</span> <span class="o">=</span> <span class="p">{</span>
<span class="s">'allowed_fruits'</span><span class="p">:[</span><span class="s">'apple'</span><span class="p">,</span> <span class="s">'orange'</span><span class="p">,</span> <span class="s">'banana'</span><span class="p">],</span>
<span class="s">'fruits_limit_per_day'</span><span class="p">:</span> <span class="mi">8</span>
<span class="p">}</span>

</code></pre></div></div>

<p>Now we have a set of changeable conditions. The first one describes, allowed fruits for consumption, while 
the second one seems to be a limiting factor for the day. Next is to write a simple loader.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c"># config.py</span>

<span class="c"># As out config is in JSON Format, we will use json module to load the json file</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="k">class</span> <span class="nc">LibraryConfiguration</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_path</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
        <span class="s">"""
        Class Constructor
        config_path: Configuration File Path
        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALLOWED_FRUITS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_data</span><span class="p">[</span><span class="s">'ALLOWED_FRUITS'</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FRUITS_LIMIT_PER_DAY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_data</span><span class="p">[</span><span class="s">'FRUIT_LIMIT_PER_DAY'</span><span class="p">]</span>
        
    
    <span class="k">def</span> <span class="nf">update_library_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_path</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
        <span class="s">"""
        Function to update library config
        config_path: Configuration File Path
        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="n">config_path</span><span class="p">)</span>

<span class="n">library_configuration</span>  <span class="o">=</span> <span class="n">LibraryConfiguration</span><span class="p">(</span><span class="s">'config.json'</span><span class="p">)</span>
    
</code></pre></div></div>

<p>Lets start defining the functionalities for our library, we have three modules, namely morning and evening
consumptions -</p>

<p>Morning Consumption Module</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c"># morning_consumption.py</span>

<span class="c"># We need to import Configuration,</span>
<span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">library_configuration</span> <span class="k">as</span> <span class="n">config</span>


<span class="k">class</span> <span class="nc">MorningConsumption</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">check_consumption_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">consumed_fruits</span><span class="p">:</span><span class="nb">int</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">consumed_fruits</span> <span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">FRUIT_LIMIT_PER_DAY</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">'Bad Consumption Rate'</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">'Good Consumption Rate'</span>
</code></pre></div></div>

<p>Evening Consumption Module</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c"># evening_consumption.py</span>

<span class="c"># We need to import Configuration,</span>
<span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">LibraryConfiguration</span>

<span class="c"># Lets create configuration object and feed it with our config.json which we created earlier</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">LibraryConfiguration</span><span class="p">(</span><span class="s">'config.json'</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">EveningConsumption</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">check_consumption_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">consumed_fruits</span><span class="p">:</span><span class="nb">int</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">consumed_fruits</span> <span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">FRUIT_LIMIT_PER_DAY</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">'Bad Consumption Rate'</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">'Good Consumption Rate'</span>
              
</code></pre></div></div>

<p>Our Main module</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c"># main.py</span>

<span class="c"># Import morning and evening consumption modules</span>
<span class="kn">from</span> <span class="nn">morning_consumption</span> <span class="kn">import</span> <span class="n">MorningConsumption</span>
<span class="kn">from</span> <span class="nn">evening_consumption</span> <span class="kn">import</span> <span class="n">EveningConsumption</span>

<span class="n">morning_consumption</span> <span class="o">=</span> <span class="n">MorningConsumption</span><span class="p">()</span>
<span class="n">evening_consumption</span> <span class="o">=</span> <span class="n">EveningConsumption</span><span class="p">()</span>


<span class="n">morning_consumption</span><span class="o">.</span><span class="n">check_consumption_rate</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="c"># Output: Good Consumption</span>

<span class="s">'''           
Now lets say the child fell sick in the evening and the doctor advised to limit the 
number of fruits/day to just 4 and exclude banana.
'''</span>
<span class="n">config</span><span class="o">.</span><span class="n">FRUIT_LIMIT_PER_DAY</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">config</span><span class="o">.</span><span class="n">ALLOWED_FRUITS</span> <span class="o">=</span> <span class="p">[</span><span class="s">'apple'</span><span class="p">,</span> <span class="s">'orange'</span><span class="p">]</span>  

<span class="n">evening_consumption</span><span class="o">.</span><span class="n">check_consumption_rate</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="c"># Output: Good Consumption (Something is missing here)</span>
</code></pre></div></div>

<p>Even though we changed consumption limit after doctor’s advice, our evening module did not 
warn us about the consumption rate. Ideally we should have got - <strong>Bad Consumption (7&gt;4)</strong> but we 
got <strong>Good Consumption</strong>.</p>

<p>Reason - <em>To err is human</em>. We made a mistake when we created a new config object in our
evening module. To solve this we need to import the <code class="highlighter-rouge">config</code> object instead of <code class="highlighter-rouge">LibraryConfiguration</code> class
{or} we can have a restriction throughout our library stating that, only a single instance of the LibraryConfiguration
should exist. I like the second one as it give some room for mistakes :P.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c"># test.py</span>

<span class="k">class</span> <span class="nc">SimpleClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
        
<span class="n">sample_1</span> <span class="o">=</span> <span class="n">SimpleClass</span><span class="p">()</span>
<span class="n">sample_2</span> <span class="o">=</span> <span class="n">SimpleClass</span><span class="p">()</span>

<span class="nb">id</span><span class="p">(</span><span class="n">sample_1</span><span class="p">)</span> <span class="c"># prints 4372114624</span>
<span class="nb">id</span><span class="p">(</span><span class="n">sample_1</span><span class="p">)</span> <span class="c"># prints 4372114568</span>
       
</code></pre></div></div>

<p>Our Goal is to have a single instance. Lets dive deep into Singleton Pattern</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c"># singleton.py</span>

<span class="k">class</span> <span class="nc">Singleton</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="s">"""
    Singleton Class
    """</span>
    <span class="n">_instances</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cls</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">_instances</span><span class="p">:</span>
            <span class="n">cls</span><span class="o">.</span><span class="n">_instances</span><span class="p">[</span><span class="n">cls</span><span class="p">]</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Singleton</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_instances</span><span class="p">[</span><span class="n">cls</span><span class="p">]</span>
</code></pre></div></div>

<p>Such an intuitive design. As simple as it might seem, its usage benefits greatly. The ideology is simple - 
<em>When an instance for a class is created, store the instance and when a developer creates a new instance, return the
stored instance</em> Lets head back to our SimpleClass problem. Our goal is to have a single instance.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c"># test.py</span>

<span class="kn">from</span> <span class="nn">singleton</span> <span class="kn">import</span> <span class="n">Singleton</span>

<span class="k">class</span> <span class="nc">SimpleClass</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">Singleton</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">pass</span>
        
<span class="n">sample_1</span> <span class="o">=</span> <span class="n">SimpleClass</span><span class="p">()</span>
<span class="n">sample_2</span> <span class="o">=</span> <span class="n">SimpleClass</span><span class="p">()</span>

<span class="nb">id</span><span class="p">(</span><span class="n">sample_1</span><span class="p">)</span> <span class="c"># prints 4575457632</span>
<span class="nb">id</span><span class="p">(</span><span class="n">sample_1</span><span class="p">)</span> <span class="c"># prints 4575457632</span>

<span class="k">print</span><span class="p">(</span><span class="n">sample_1</span><span class="o">.</span><span class="n">var</span><span class="p">)</span> <span class="c"># prints 10</span>
<span class="n">sample_1</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="mi">25</span>
<span class="k">print</span><span class="p">(</span><span class="n">sample_2</span><span class="o">.</span><span class="n">var</span><span class="p">)</span> <span class="c"># prints 25</span>
</code></pre></div></div>

<p>Aha, we now have a solution to our problem we faced in our library. Our <strong>LibraryConfiguration</strong> class
should have a metaclass (baseclass) as <strong>Singleton</strong>. This post might feel long for experienced developers,
but for starters, I feel its apt. For me programming was fun and simple when the explanation had a relation to 
real world example. It was fun explaining stuff. Signing off till next post.</p>


  </article>

    

    
       <div class="block">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
      var disqus_shortname = "https-kingspp-github-io";
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
</div>
    

  <div class="post-up" align="center">
  	<a href="#">
  	<i class="fa fa-angle-up fa-2x"></i>
  	</a>
  </div>

</div>

      </div>
    </div>

  <div class="footer center">

  Built with Jekyll using
  <a href="https://github.com/kuoa/julia" target="_blank">Julia</a>
  theme
  <img src='/assets/logo.png'>

</div>


  </body>
</html>
